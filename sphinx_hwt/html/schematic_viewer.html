<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>HW schematic viewer</title>
  <script type="text/javascript" src="node_modules/d3/dist/d3.js"></script>
  <script type="text/javascript" src="node_modules/d3-hwschematic/dist/d3-hwschematic.js"></script>
  <script type="text/javascript" src="node_modules/d3-hwschematic/src/elk/elk-worker.js"></script>
  <link rel="stylesheet" href="schematic_viewer.css">
</head>
<body>
    <svg id="scheme-placeholder"></svg>
    <script>
        function viewport() {
          var e = window,
            a = 'inner';
          if (!('innerWidth' in window)) {
            a = 'client';
            e = document.documentElement || document.body;
          }
          return {
            width: e[a + 'Width'],
            height: e[a + 'Height']
          }
        }
        var width = viewport().width,
            height = viewport().height;
        
        var svg = d3.select("#scheme-placeholder")
          .attr("width", width)
          .attr("height", height);

        var orig = document.body.onresize;
        document.body.onresize = function(ev) {
            if (orig)
        	    orig(ev);

            var w = viewport();
            svg.attr("width", w.width);
			svg.attr("height", w.height);
        }

        var zoom = d3.zoom();
        zoom.on("zoom", function applyTransform() {
            g.root.attr("transform", d3.event.transform)
        });

        // disable zoom on doubleclick 
        // because it interferes with component expanding/collapsing
        svg.call(zoom)
           .on("dblclick.zoom", null)

        var g = new d3.HwSchematic(svg);

    </script>
    <script>
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        var schematic_url = getParameterByName("schematic");
        if (schematic_url == null)
        	throw Error("schematic url was not specified");

        d3.json(schematic_url)
          .then(function(graph) {
              if (graph.hwt && graph.hwt.name)
                  document.title = graph.hwt.name;
              // load the data and render the elements
              g.bindData(graph);
           });
    </script>
</body>
</html>
